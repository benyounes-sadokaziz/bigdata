# ============================================================
# Flume Configuration for Log File Processing
# Agent name: log-agent
# ============================================================

# Define the agent
log-agent.sources = log-source
log-agent.channels = memory-channel
log-agent.sinks = hdfs-sink

# ============================================================
# SOURCE: Spooling Directory
# ============================================================
log-agent.sources.log-source.type = spooldir
log-agent.sources.log-source.spoolDir = /logs/incoming
log-agent.sources.log-source.fileHeader = true
log-agent.sources.log-source.deletePolicy = immediate
log-agent.sources.log-source.fileSuffix = .processed
log-agent.sources.log-source.ignorePattern = ^\..*$
log-agent.sources.log-source.trackerDir = /logs/.flume
log-agent.sources.log-source.batchSize = 100

# ============================================================
# CHANNEL: Memory Channel
# ============================================================
log-agent.channels.memory-channel.type = memory
log-agent.channels.memory-channel.capacity = 10000
log-agent.channels.memory-channel.transactionCapacity = 1000

# ============================================================
# SINK: HDFS Sink (partitioned by date)
# ============================================================
log-agent.sinks.hdfs-sink.type = hdfs
log-agent.sinks.hdfs-sink.hdfs.path = hdfs://namenode:9000/user/flume/logs/%Y/%m/%d
log-agent.sinks.hdfs-sink.hdfs.filePrefix = ecommerce-logs-
log-agent.sinks.hdfs-sink.hdfs.fileSuffix = .log
log-agent.sinks.hdfs-sink.hdfs.rollInterval = 300
log-agent.sinks.hdfs-sink.hdfs.rollSize = 0
log-agent.sinks.hdfs-sink.hdfs.rollCount = 0
log-agent.sinks.hdfs-sink.hdfs.fileType = DataStream
log-agent.sinks.hdfs-sink.hdfs.writeFormat = Text
log-agent.sinks.hdfs-sink.hdfs.useLocalTimeStamp = true
log-agent.sinks.hdfs-sink.hdfs.batchSize = 1000
log-agent.sinks.hdfs-sink.hdfs.round = true
log-agent.sinks.hdfs-sink.hdfs.roundValue = 10
log-agent.sinks.hdfs-sink.hdfs.roundUnit = minute

# ============================================================
# BIND SOURCE AND SINK TO CHANNEL
# ============================================================
log-agent.sources.log-source.channels = memory-channel
log-agent.sinks.hdfs-sink.channel = memory-channel
