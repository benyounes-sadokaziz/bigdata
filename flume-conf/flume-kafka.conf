# ============================================================
# Flume Configuration for Kafka Consumer
# Agent name: kafka-agent
# ============================================================

# Define the agent
kafka-agent.sources = kafka-source
kafka-agent.channels = file-channel
kafka-agent.sinks = hdfs-sink

# ============================================================
# SOURCE: Kafka Source
# ============================================================
kafka-agent.sources.kafka-source.type = org.apache.flume.source.kafka.KafkaSource
kafka-agent.sources.kafka-source.kafka.bootstrap.servers = kafka:29092
kafka-agent.sources.kafka-source.kafka.topics = ecommerce-transactions
kafka-agent.sources.kafka-source.kafka.consumer.group.id = flume-consumer-group
kafka-agent.sources.kafka-source.batchSize = 100
kafka-agent.sources.kafka-source.batchDurationMillis = 2000

# ============================================================
# CHANNEL: File Channel (more reliable than memory)
# ============================================================
kafka-agent.channels.file-channel.type = file
kafka-agent.channels.file-channel.checkpointDir = /opt/flume/checkpoint/kafka
kafka-agent.channels.file-channel.dataDirs = /opt/flume/data/kafka
kafka-agent.channels.file-channel.maxFileSize = 2146435071
kafka-agent.channels.file-channel.capacity = 1000000
kafka-agent.channels.file-channel.keep-alive = 3

# ============================================================
# SINK: HDFS Sink (partitioned by date and hour)
# ============================================================
kafka-agent.sinks.hdfs-sink.type = hdfs
kafka-agent.sinks.hdfs-sink.hdfs.path = hdfs://namenode:9000/user/flume/kafka-transactions/%Y/%m/%d/%H
kafka-agent.sinks.hdfs-sink.hdfs.filePrefix = kafka-txn-
kafka-agent.sinks.hdfs-sink.hdfs.fileSuffix = .json
kafka-agent.sinks.hdfs-sink.hdfs.rollInterval = 600
kafka-agent.sinks.hdfs-sink.hdfs.rollSize = 0
kafka-agent.sinks.hdfs-sink.hdfs.rollCount = 0
kafka-agent.sinks.hdfs-sink.hdfs.fileType = DataStream
kafka-agent.sinks.hdfs-sink.hdfs.writeFormat = Text
kafka-agent.sinks.hdfs-sink.hdfs.useLocalTimeStamp = true
kafka-agent.sinks.hdfs-sink.hdfs.batchSize = 100
kafka-agent.sinks.hdfs-sink.hdfs.round = true
kafka-agent.sinks.hdfs-sink.hdfs.roundValue = 10
kafka-agent.sinks.hdfs-sink.hdfs.roundUnit = minute

# ============================================================
# BIND SOURCE AND SINK TO CHANNEL
# ============================================================
kafka-agent.sources.kafka-source.channels = file-channel
kafka-agent.sinks.hdfs-sink.channel = file-channel
